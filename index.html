<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><title>Perros y Gatos</title><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"><style>#resultado{font-weight:700;font-size:6rem;text-align:center}.canvas-container{margin:0 auto;border:1px solid #ccc}</style><script defer="defer" src="/static/js/main.0147d6a7.js"></script><link href="/static/css/main.d63a606f.css" rel="stylesheet"></head><body><div id="root"></div><main><div class="px-4 py-2 my-2 text-center border-bottom"><h1 class="display-5 fw-bold">Perros y gatos</h1><div class="col-lg-6 mx-auto"><p class="lead mb-0">Clasificaci&oacute;n de im√°genes (Perro o Gato) usando la c&aacute;mara web utilizando Tensorflow.js</p></div></div><div class="b-example-divider"></div><div class="container mt-5"><div class="row"><div class="col-12 col-md-4 offset-md-4 text-center"><video id="video" playsinline autoplay style="width:1px"></video><button class="btn btn-primary mb-2" id="cambiar-camara" onclick="cambiarCamara()">Cambiar camara</button><canvas id="canvas" width="400" height="400" style="max-width:100%"></canvas><canvas id="othercanvas" width="150" height="150" style="display:none"></canvas><div id="resultado"></div></div></div></div><div class="b-example-divider"></div></main><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script><script type="text/javascript">var canvas=document.getElementById("canvas"),video=document.getElementById("video"),ctx=canvas.getContext("2d"),modelo=null,size=400,camaras=[],currentStream=null,facingMode="user";function mostrarCamara(){var a={audio:!1,video:{facingMode:"user",width:size,height:size}};navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(a).then((function(a){currentStream=a,video.srcObject=currentStream,procesarCamara(),predecir()})).catch((function(a){alert("No se pudo utilizar la camara :("),console.log("No se pudo utilizar la camara :(",a),alert(a)})):alert("No existe la funcion getUserMedia... oops :( no se puede usar la camara")}function cambiarCamara(){currentStream&&currentStream.getTracks().forEach((a=>{a.stop()}));var a={audio:!1,video:{facingMode:facingMode="user"==facingMode?"environment":"user",width:size,height:size}};navigator.mediaDevices.getUserMedia(a).then((function(a){currentStream=a,video.srcObject=currentStream})).catch((function(a){console.log("Oops, hubo un error",a)}))}function predecir(){if(null!=modelo){resample_single(canvas,150,150,othercanvas);for(var a=othercanvas.getContext("2d").getImageData(0,0,150,150),e=[],t=[],r=0;r<a.data.length;r+=4){var o=a.data[r]/255,n=a.data[r+1]/255,i=a.data[r+2]/255;t.push([o,n,i]),150==t.length&&(e.push(t),t=[])}e=[e];var c=tf.tensor4d(e),d=modelo.predict(c).dataSync(),s=d.indexOf(Math.max.apply(null,d)),l=["Gato","Perro"];console.log("Prediccion",l[s]),document.getElementById("resultado").innerHTML=l[s]}setTimeout(predecir,150)}function procesarCamara(){canvas.getContext("2d").drawImage(video,0,0,size,size,0,0,size,size),setTimeout(procesarCamara,20)}function resample_single(a,e,t,r){for(var o=a.width,n=a.height,i=o/(e=Math.round(e)),c=n/(t=Math.round(t)),d=Math.ceil(i/2),s=Math.ceil(c/2),l=a.getContext("2d"),u=r.getContext("2d"),m=l.getImageData(0,0,o,n),g=u.createImageData(e,t),h=m.data,v=g.data,f=0;f<t;f++)for(var M=0;M<e;M++){for(var p=4*(M+f*e),z=0,C=0,x=0,y=0,I=0,S=0,w=0,D=(f+.5)*c,b=Math.floor(f*c),E=Math.ceil((f+1)*c),O=b;O<E;O++)for(var T=Math.abs(D-(O+.5))/s,U=(M+.5)*i,B=T*T,N=Math.floor(M*i),j=Math.ceil((M+1)*i),L=N;L<j;L++){var P=Math.abs(U-(L+.5))/d,_=Math.sqrt(B+P*P);if(!(_>=1)){var k=4*(L+O*o);w+=(z=2*_*_*_-3*_*_+1)*h[k+3],x+=z,h[k+3]<255&&(z=z*h[k+3]/250),y+=z*h[k],I+=z*h[k+1],S+=z*h[k+2],C+=z}}v[p]=y/C,v[p+1]=I/C,v[p+2]=S/C,v[p+3]=w/x}u.putImageData(g,0,0)}(async()=>{console.log("Cargando modelo..."),modelo=await tf.loadLayersModel("https://artificialintelligence-api.fly.dev/recognizecatordog/model"),console.log("Modelo cargado...")})(),window.onload=function(){mostrarCamara()}</script></body></html>